<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Today's Price</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background-color: #f7f9fb;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1, h2, h3 {
            margin: 0.5em 0;
        }

        .header-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #004d99;
        }

        .total-value {
            font-size: 5rem;
            font-weight: bold;
            color: #111;
        }

        .currency {
            font-size: 1.5rem;
            color: #666;
        }

        .summary {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-top: 1.5rem;
            font-size: 1.2rem;
        }

        .summary div {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .positive { color: #4caf50; }
        .negative { color: #f44336; }

        .stocks-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .stock-card {
            padding: 1.5rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            min-width: 260px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .stock-card h2 {
            margin-bottom: 0.5rem;
        }

        .stock-card p {
            margin: 0.3rem 0;
        }

        .goog { background-color: #B3E5FC; }
        .tsla { background-color: #FFCC80; }
    </style>

    <style>
        /* 移除左側黑色長方形樣式 */
    </style>

</head>
<body>
    <div class="content">
        <h1 class="header-title">庫存股總市值</h1>
        <div class="currency">USD</div>
        <div id="total-value" class="total-value">載入中...</div>

        <div class="summary">
            <div>
                <div>報酬率</div>
                <div id="roi" class="stat-value">--%</div>
            </div>
            <div>
                <div>損益</div>
                <div id="profit" class="stat-value">--</div>
            </div>
            <div>
                <div>成本</div>
                <div id="cost" class="stat-value">--</div>
            </div>
        </div>

        <div class="stocks-container">
            <div class="stock-card goog">
                <h2>GOOG</h2>
                <p id="goog">載入中...</p>
            </div>
            <div class="stock-card tsla">
                <h2>TSLA</h2>
                <p id="tsla">載入中...</p>
            </div>
        </div>
    </div>

    <script>
        async function fetchPrice(symbol, elementId) {
            try {
                const res = await fetch(`/price?symbol=${symbol}`);
                const data = await res.json();
                if (data.price) {
                    if (symbol === 'GOOG') {
                        const basis = 313.52;
                        const change = ((data.price - basis) / basis * 100).toFixed(2);
                        const sign = data.price >= basis ? '+' : '-';
                        document.getElementById(elementId).textContent = `USD ${data.price} (Basis : ${basis}, ${sign}${Math.abs(change)}%)`;
                    } else if (symbol === 'TSLA') {
                        const basis = 449.56;
                        const change = ((data.price - basis) / basis * 100).toFixed(2);
                        const sign = data.price >= basis ? '+' : '-';
                        document.getElementById(elementId).textContent = `USD ${data.price} (Basis : ${basis}, ${sign}${Math.abs(change)}%)`;
                    } else {
                        document.getElementById(elementId).textContent = `USD ${data.price}`;
                    }
                } else {
                    document.getElementById(elementId).textContent = '無效代號';
                }
            } catch (error) {
                document.getElementById(elementId).textContent = '錯誤';
            }
        }

        function updatePrices() {
            fetchPrice('GOOG', 'goog');
            fetchPrice('TSLA', 'tsla');
        }

        updatePrices();
        setInterval(updatePrices, 60000);

        // 計算與更新投資現況統計
        function updatePortfolioSummary(googPrice, tslaPrice) {
            const totalMarketValue = googPrice * 2 + tslaPrice * 1;
            const totalCost = (313.52 * 2) + (449.56 * 1);
            const profit = totalMarketValue - totalCost;
            const roi = (profit / totalCost) * 100;

            document.getElementById("total-value").textContent = totalMarketValue.toFixed(2);
            document.getElementById("cost").textContent = totalCost.toFixed(2);
            document.getElementById("profit").textContent = profit.toFixed(2);
            const roiElement = document.getElementById("roi");
            roiElement.textContent = roi.toFixed(2) + "%";
            roiElement.className = roi >= 0 ? "positive" : "negative";
        }

        async function updatePrices() {
            try {
                const [googRes, tslaRes] = await Promise.all([
                    fetch('/price?symbol=GOOG'),
                    fetch('/price?symbol=TSLA')
                ]);
                const googData = await googRes.json();
                const tslaData = await tslaRes.json();
        
                // 更新單支股票顯示格式
                if (googData.price) {
                    const basisGOOG = 313.52;
                    const changeGOOG = ((googData.price - basisGOOG) / basisGOOG * 100).toFixed(2);
                    const signGOOG = googData.price >= basisGOOG ? '+' : '-';
                    document.getElementById('goog').textContent =
                        `USD ${googData.price} (Basis : ${basisGOOG}, ${signGOOG}${Math.abs(changeGOOG)}%)`;
                }
        
                if (tslaData.price) {
                    const basisTSLA = 449.56;
                    const changeTSLA = ((tslaData.price - basisTSLA) / basisTSLA * 100).toFixed(2);
                    const signTSLA = tslaData.price >= basisTSLA ? '+' : '-';
                    document.getElementById('tsla').textContent =
                        `USD ${tslaData.price} (Basis : ${basisTSLA}, ${signTSLA}${Math.abs(changeTSLA)}%)`;
                }
        
                // 更新投資統計區塊
                updatePortfolioSummary(googData.price, tslaData.price);
            } catch (error) {
                console.error('更新價格或統計資料時發生錯誤：', error);
            }
        }

        updatePrices();
    </script>

</body>
</html>